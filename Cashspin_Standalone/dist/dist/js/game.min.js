var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("cashspin",["require","exports","scenemanager","scenemanager","scenemanager","scenemanager","scenemanager"],function(e,t,i,n,a,o,s){"use strict";var r=(function(){function e(){}}(),function(){function e(){}return e}()),l=function(e){function t(){var t=e.call(this)||this;return t.temPayLines=new Array,t.bGameFinished=!1,n.log.info("Game Instantiated"),t}return __extends(t,e),t.prototype.Start=function(){var e=this;a.default.game.sound.mute=!1,this.offset=90,this.currentAngle=0,this.lineSpacing=40,this.fontSizeOffset=.15,this.wheel=a.default.getGameObjectByName("Wheel"),this.wheel.inputEnabled=!0,this.pointer=a.default.getGameObjectByName("Pointer"),this.spinButton=a.default.getGameObjectByName("SpinButtonUp"),this.glove=a.default.getGameObjectByName("glove"),this.exit=a.default.getGameObjectByName("Exit Button"),this.getReadyToSpin=a.default.getGameObjectByName("ready"),this.spinSound=a.default.getGameObjectByName("spinSound"),this.tickSound=a.default.getGameObjectByName("tick"),this.background=a.default.getGameObjectByName("background"),this.touchToSpin=a.default.getGameObjectByName("touchToSpin"),this.thanksForPlaying=a.default.getGameObjectByName("thanksForPlaying"),this.celebrateSound=a.default.getGameObjectByName("celebrate"),this.touchAndSpinSprite=a.default.getGameObjectByName("TouchAndSpin"),this.taptostart=a.default.getGameObjectByName("TapToStart"),this.winAmount=a.default.getGameObjectByName("winamount"),this.winAmountWithDescription=a.default.getGameObjectByName("winamountWithDescription"),this.popUp=a.default.getGameObjectByName("popup"),this.muteObject=a.default.getGameObjectByName("mute"),this.touchAndSpinSprite.visible=!1,this.tickSound.allowMultiple=!0,this.startSpinAngle=0,this.popUp.addChild(this.winAmount),this.popUp.addChild(this.winAmountWithDescription),o.OfferManager.IsStandalone&&(this.taptostart.inputEnabled=!0),this.gloveParent=a.default.game.add.sprite(this.wheel.position.x,this.wheel.position.y),this.gloveParent.addChild(this.glove),this.gloveParent.visible=!1,this.glove.position=new Phaser.Point(0,-300),this.muteObject.inputEnabled=!0,this.winAmount.stroke="#000000",this.winAmount.strokeThickness=10,this.coin1=a.default.getGameObjectByName("coin1"),this.coin2=a.default.getGameObjectByName("coin2"),this.coin3=a.default.getGameObjectByName("coin3"),this.dollar=a.default.getGameObjectByName("dollar"),this.popUp.inputEnabled=!0,this.popUp.input.enableDrag(!0);var t=new Phaser.Rectangle(-100,-100,1600,900);if(this.popUp.input.boundsRect=t,this.popUp.input.dragFromCenter=!1,this.wheel.events.onInputDown.add(function(){e.pointerDown=!0;var t=Phaser.Point.subtract(e.wheel.position,a.default.game.input.position);e.startAngle=Math.atan2(t.y,t.x)}),this.wheel.events.onInputUp.add(function(){e.pointerDown=!1,e.wheel.rotation-e.wheel.previousRotation<0?e.toggleWheel=!0:e.toggleWheel=!1,Math.abs(e.wheel.rotation-e.startSpinAngle)>Math.PI/18?e.spin():e.startSpinAngle=e.wheel.rotation}),1==o.OfferManager.IsStandalone){this.temPayLines=new Array,this.temPayLines.length=30;for(var i=0;i<30;++i)this.temPayLines[i]=new r,this.temPayLines[i].FormattedPrize=i%10==0?"$5.00":i%10==1?"¥ 20,000,000.00":i%10==2?"€20.00":i%10==3?"R 10 000.00":i%10==4?"£ 10.000.000,00":i%10==5?"Sfr.50,000.00":i%10==6?"50'000'000,00฿":i%10==7?"Php50.00":i%10==8?"₱ 56,00":"10 000,00 Yen",this.temPayLines[i].Value=i%10==0?5:i%10==1?2e7:i%10==2?20:i%10==3?1e4:i%10==4?1e7:i%10==5?5e4:i%10==6?5e7:i%10==7?50:i%10==8?56:1e4,this.temPayLines[i].IsWinner=0!=i,this.temPayLines[i].PrizeTypeID=1,this.temPayLines[i].Suffix="$";this.tempWinningPayLine=new r,this.tempWinningPayLine.FormattedPrize="$50.00",this.tempWinningPayLine.IsWinner=!0,this.tempWinningPayLine.PrizeTypeID=1,this.tempWinningPayLine.Prefix="$",this.tempWinningPayLine.Suffix="$",this.tempWinningPayLine.Value=50}},t.prototype.IsStringANumber=function(e){return"0"==e||"1"==e||"2"==e||"3"==e||"4"==e||"5"==e||"6"==e||"7"==e||"8"==e||"9"==e},t.prototype.RemoveAllSeparators=function(e,t){var i=e;for(i.length;;){var n=i.indexOf(t);if(-1==n)break;i=i.substring(0,n)+i.substring(n+1,i.length)}return i},t.prototype.ExtractCurrencySymbol=function(e){e=this.RemoveAllSeparators(e,","),e=this.RemoveAllSeparators(e,"."),e=this.RemoveAllSeparators(e," "),e=this.RemoveAllSeparators(e,"'");for(var t=-1,i=-1,n=0;n<e.length;++n)if(0==this.IsStringANumber(e[n])){if(-1==t){t=n;continue}}else if(-1!=t){i=n;break}return-1!=t&&(e=-1==i?e.substring(t):e.substring(t,i+t)),e},t.prototype.FillWheel=function(){for(var e=0;e<30;){if(0!=this.temPayLines[e].PrizeTypeID){this.temPayLines[e].IsWinner&&(this.winPayline=e);var t="",i="";1==this.temPayLines[e].PrizeTypeID?(t=this.ExtractCurrencySymbol(this.temPayLines[e].FormattedPrize),i=this.temPayLines[e].Value.toString()):2==this.temPayLines[e].PrizeTypeID?(t="pts",i=this.temPayLines[e].Value.toString()):i=this.temPayLines[e].FormattedPrize;var n=1,o=i.length;""!=t&&o++,o<=4?n=1.3:5==o?n=1.2:7==o?n=.84:8==o?n=.74:9==o?n=.65:10==o?n=.57:11==o?n=.515:12==o?n=.475:13==o?n=.434:o>=14&&(n=.407);for(var s=0;s<o&&s<14;){var r,l=n;if(""!=t&&0==s)r=a.default.game.add.text(100,500,t,{font:"50px Arial Black",fill:"#000000",align:"center"}),r.fill="#00c000",l=.84;else{var p=s;""!=t&&--p,r=a.default.game.add.text(100,500,i[p],{font:"50px Arial Black",fill:"#000000",align:"center"})}r.stroke="#ffffff",r.strokeThickness=6,r.anchor.set(.5);var h=6*this.fontSizeOffset*l;r.scale=new Phaser.Point(h,h),this.wheel.addChild(r);var u=this.lineSpacing*n,f=0;""!=t&&s>0&&(f=-5),r.position=new Phaser.Point((425-s*u+f)*Math.cos((360-12*e)*Math.PI/180),(425-s*u+f)*Math.sin((360-12*e)*Math.PI/180)),r.rotation=(360-12*e+90)*Math.PI/180,s++}}else for(var g=0;g<this.temPayLines[e].FormattedPrize.toString().length;){var r=a.default.game.add.text(100,500,this.temPayLines[e].Value.toString()[g]+"",{font:"50px Arial Black",fill:"#000000",align:"center"});r.stroke="#ffffff",r.strokeThickness=6,r.anchor.set(.5),r.scale=new Phaser.Point(1.1-this.fontSizeOffset*g,1.1-this.fontSizeOffset*g),this.wheel.addChild(r),r.position=new Phaser.Point((430-(g+1)*this.lineSpacing)*Math.cos((360-12*e)*Math.PI/180),(430-(g+1)*this.lineSpacing)*Math.sin((360-12*e)*Math.PI/180)),r.rotation=(360-12*e+90)*Math.PI/180,g++}e++}},t.prototype.BonusGameState=function(e){var t=this;if(e==s.BonusGameState.beginGameAcked){if(this.promotionAvailable=!0,0==o.OfferManager.IsStandalone){this.temPayLines=new Array,this.temPayLines.length=30;for(var i=0;i<30;++i)this.temPayLines[i]=new r,this.temPayLines[i].FormattedPrize=o.OfferManager.OfferConfiguration.PayTable.PayLines[i].FormattedPrize,this.temPayLines[i].IsWinner=o.OfferManager.OfferConfiguration.PayTable.PayLines[i].IsWinner,this.temPayLines[i].PrizeTypeID=o.OfferManager.OfferConfiguration.PayTable.PayLines[i].PrizeTypeID,this.temPayLines[i].Suffix=o.OfferManager.OfferConfiguration.PayTable.PayLines[i].Suffix,this.temPayLines[i].Value=o.OfferManager.OfferConfiguration.PayTable.PayLines[i].Value;this.tempWinningPayLine=new r,this.tempWinningPayLine.FormattedPrize=o.OfferManager.OfferConfiguration.WinningPayLine.FormattedPrize,this.tempWinningPayLine.IsWinner=o.OfferManager.OfferConfiguration.WinningPayLine.IsWinner,this.tempWinningPayLine.PrizeTypeID=o.OfferManager.OfferConfiguration.WinningPayLine.PrizeTypeID,this.tempWinningPayLine.Suffix=o.OfferManager.OfferConfiguration.WinningPayLine.Suffix,this.tempWinningPayLine.Value=o.OfferManager.OfferConfiguration.WinningPayLine.Value}this.FillWheel(),this.taptostart.inputEnabled=!0,o.OfferManager.IsWebView&&(this.exit.visible=!0)}if(e==s.BonusGameState.endGameAcked){this.currentAngle=0,this.winAmount.setText(o.OfferManager.GetCurrencyStringFromNumber(this.tempWinningPayLine.Value),!0);var n=a.default.game.add.tween(this.winAmount).to({alpha:1},3500,Phaser.Easing.Quadratic.Out,!0);this.thanksForPlaying.play("",0,1,!1,!1),o.OfferManager.IsWebView&&(this.exit.visible=!0),this.popUp.visible=!0,this.winAmount.visible=!0,this.winAmountWithDescription.visible=!0,n.onUpdateCallback(function(e,i,n){if(1==t.tempWinningPayLine.PrizeTypeID)var a=o.OfferManager.GetCurrencyStringFromNumber(i*t.tempWinningPayLine.Value);else if(2==t.tempWinningPayLine.PrizeTypeID)var a=(i*t.tempWinningPayLine.Value).toFixed(0)+" pts";else if(t.tempWinningPayLine.Value>1)var a=t.tempWinningPayLine.Prefix+(i*t.tempWinningPayLine.Value).toFixed(0)+t.tempWinningPayLine.Suffix;else var a=t.tempWinningPayLine.FormattedPrize;t.winAmount.setText(a)}),n.onComplete.add(function(){if(1==t.tempWinningPayLine.PrizeTypeID){var e=o.OfferManager.GetCurrencyStringFromNumber(t.tempWinningPayLine.Value);t.dollar.start(!1,2500,10)}else if(2==t.tempWinningPayLine.PrizeTypeID)var e=t.tempWinningPayLine.Value.toFixed(0)+" pts";else{t.tempWinningPayLine.FormattedPrize}t.coin1.start(!1,1400,10),t.coin2.start(!1,1400,10),t.coin3.start(!1,1400,10),t.winAmount.setText(e),setTimeout(function(){if(t.coin1.on=!1,t.coin2.on=!1,t.coin3.on=!1,t.dollar.on=!1,t.winAmount.visible=!1,o.OfferManager.IsStandalone)t.winAmountWithDescription.text="Congratulations!!! You won $5!";else{var e=o.OfferManager.OfferConfiguration.PlayerInfo.PlayerName;e.length>20&&(e=e.substring(0,20)),e.length>1&&(e=" "+e),t.winAmountWithDescription.text="Congratulations"+e+"!!! You won "+o.OfferManager.OfferConfiguration.WinningPayLine.FormattedPrize+"!"}t.bGameFinished=!0,a.default.ToggleGameEndMessage(!0)},3e3),t.celebrateSound.play("",0,1,!0,!1),t.celebrateSound.fadeTo(6e3,0),a.default.game.add.tween(t.winAmount.scale).to({x:1.5,y:1.5},250,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)})}},t.prototype.OnVolumeToggle=function(){a.default.game.sound.mute?(this.loadTexture("MainAtlas2","mute"),a.default.game.sound.mute=!1):(this.loadTexture("MainAtlas2","vol"),a.default.game.sound.mute=!0)},t.prototype.OnSpinClicked=function(){var e=a.default.getComponent(t);this.inputEnabled=!1,e.spinComplete||(a.default.game.add.tween(this.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),e.spin())},t.prototype.OnExitClicked=function(){o.OfferManager.ExitGame()},t.prototype.OnTapToStart=function(){var e=a.default.getComponent(t);e.promotionAvailable&&(e.exit.visible=!1,this.visible=!1,e.spinButton.inputEnabled=!0,e.getReadyToSpin.play("",0,1,!1,!1),setTimeout(function(){e.spinComplete||(e.background.play("",0,1,!0,!1),e.callOnMilliSeconds(1e3))},5e3))},t.prototype.Coin=function(e){},t.prototype.ArrayWithPrefix=function(e,t){for(var i=new Array(t),n=1;n<=t;)i[n]=e+n,n++;return i},t.prototype.callOnMilliSeconds=function(e){var t=this;setTimeout(function(){if(!t.spinComplete){t.touchToSpin.play("",0,1,!1,!1),t.touchAndSpinSprite.visible=!0,t.touchAndSpinSprite.scale=new Phaser.Point(.7,.7);var e=a.default.game.add.tween(t.touchAndSpinSprite.scale).to({x:1.2,y:1.2},500,Phaser.Easing.Circular.InOut,!0,0,0,!0);setTimeout(function(){e.stop(!0);var i=a.default.game.add.tween(t.touchAndSpinSprite.scale).to({x:0,y:0},500,Phaser.Easing.Circular.In,!0,0,0,!1);setTimeout(function(){if(!t.spinComplete){t.gloveParent.visible=!0;var e=a.default.game.add.tween(t.gloveParent).to({angle:90},1e3,Phaser.Easing.Sinusoidal.Out,!0,0,0,!1);e.onUpdateCallback(function(e,i,n){t.glove.angle=90*-i}),e.onComplete.add(function(){i.stop(),t.gloveParent.visible=!1,t.gloveParent.rotation=0,t.glove.rotation=0})}},2e3)},3e3),t.callOnMilliSeconds(1e4)}},e)},t.prototype.create=function(){n.log.info("create secretsoftime")},t.prototype.Render=function(){if(!this.spinComplete&&this.pointerDown&&0!=this.wheel.position.x&&0!=this.wheel.position.y){var e=Phaser.Point.subtract(this.wheel.position,a.default.game.input.position);this.wheel.rotation=Math.atan2(e.y,e.x)-this.startAngle+this.startSpinAngle}},t.prototype.Update=function(){var e=a.default.game.time.elapsed/1e3;this.popUp.visible&&(1==this.popUp.input.isDragged?(this.popUp.alpha>.3&&(this.popUp.alpha-=2*e),this.popUp.alpha<.3&&(this.popUp.alpha=.3)):(this.popUp.alpha<1&&(this.popUp.alpha+=2*e),this.popUp.alpha>1&&(this.popUp.alpha=1)))},t.prototype.spin=function(){var e=this;if(!this.spinComplete){this.spinButton.loadTexture("mainatlas","SpinButtonDisable"),this.spinComplete=!0,this.background.stop(),this.spinSound.play("",0,1,!1,!1),this.gloveParent.visible=!1;var t=a.default.game.rnd.between(1,2),i=this.winPayline,n=12*i;this.wheelTween=a.default.game.add.tween(this.wheel).to({angle:360*(this.toggleWheel?-1:1)*t+n-this.offset},7e3,Phaser.Easing.Quadratic.Out,!0);var s=3*(360*t+n-this.offset)/12;this.wheelTween.onComplete.add(function(){o.OfferManager.EndGame()}),this.wheelTween.onUpdateCallback(function(t,i,n){i>1*e.currentAngle/s&&(e.tick(i),e.currentAngle++)})}},t.prototype.tick=function(e){var t=this;a.default.game.add.tween(this.pointer).to({angle:this.toggleWheel?-80:-100},50/(1.5-e),Phaser.Easing.Sinusoidal.Out,!0,0,0,!1),setTimeout(function(){t.tickSound.play(),a.default.game.add.tween(t.pointer).to({angle:-90},20/(1.5-e),Phaser.Easing.Sinusoidal.Out,!0,0,0,!1)},51/(1.5-e))},t}(i.Component);t.CashSpin=l,Object.defineProperty(t,"__esModule",{value:!0}),t.default=l});